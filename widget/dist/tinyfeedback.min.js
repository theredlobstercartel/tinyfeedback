var TinyFeedback=function(t){"use strict";class e{constructor(t){this.container=null,this.selectedScore=null,this.options=t}open(){this.createModal(),this.attachEventListeners()}close(){this.container&&(this.container.remove(),this.container=null),this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-nps-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-nps-content",t.style.cssText=this.getModalStyles();const e=document.createElement("div");e.style.cssText=this.getHeaderStyles(),e.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">How likely are you to recommend us?</h3>\n      <p style="${this.getSubtitleStyles()}">Rate from 0 (not likely) to 10 (very likely)</p>\n    `;const n=document.createElement("div");n.id="tf-nps-scale",n.style.cssText=this.getScaleContainerStyles();for(let t=0;t<=10;t++){const e=this.createRatingButton(t);n.appendChild(e)}const i=document.createElement("div");i.id="tf-nps-comment-section",i.style.cssText=this.getCommentSectionStyles(),i.style.display="none",i.innerHTML=`\n      <textarea \n        id="tf-nps-comment" \n        placeholder="Tell us more about your experience (optional)"\n        style="${this.getTextareaStyles()}"\n      ></textarea>\n    `;const o=document.createElement("button");o.id="tf-nps-submit",o.textContent="Send Feedback",o.style.cssText=this.getSubmitButtonStyles(),o.style.display="none";const s=document.createElement("button");s.id="tf-nps-close",s.textContent="√ó",s.style.cssText=this.getCloseButtonStyles(),t.appendChild(s),t.appendChild(e),t.appendChild(n),t.appendChild(i),t.appendChild(o),this.container.appendChild(t),document.body.appendChild(this.container)}createRatingButton(t){const e=document.createElement("button");return e.className="tf-nps-rating-btn",e.dataset.score=t.toString(),e.textContent=t.toString(),e.style.cssText=this.getRatingButtonStyles(t),e}attachEventListeners(){if(!this.container)return;this.container.querySelectorAll(".tf-nps-rating-btn").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.dataset.score||"0");this.selectScore(e)})});const t=this.container.querySelector("#tf-nps-submit");t?.addEventListener("click",()=>this.submit());const e=this.container.querySelector("#tf-nps-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()})}selectScore(t){this.selectedScore=t;const e=this.container?.querySelectorAll(".tf-nps-rating-btn");e?.forEach(e=>{const n=parseInt(e.dataset.score||"0");e.style.cssText=n===t?this.getSelectedRatingButtonStyles(t):this.getRatingButtonStyles(n)});const n=this.container?.querySelector("#tf-nps-comment-section"),i=this.container?.querySelector("#tf-nps-submit");n&&(n.style.display="block"),i&&(i.style.display="block")}async submit(){if(null===this.selectedScore)return;const t=this.container?.querySelector("#tf-nps-comment"),e=t?.value?.trim();try{const t=await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"nps",nps_score:this.selectedScore,content:e||"",page_url:window.location.href,user_agent:navigator.userAgent})});if(t.ok){const n=await t.json();if(n.warning)return this.showWarning(n.warning.message,n.warning.detail),void setTimeout(()=>this.close(),3e3);this.showThankYou(),this.options.onSubmit?.(this.selectedScore,e)}else if(429===t.status){const e=await t.json();"LIMIT_REACHED"===e.error?this.showLimitReached(e.message):alert("Failed to submit feedback. Please try again.")}else console.error("Failed to submit NPS feedback"),alert("Failed to submit feedback. Please try again.")}catch(t){console.error("Error submitting NPS:",t),alert("Failed to submit feedback. Please try again.")}}showWarning(t,e){if(!this.container)return;const n=this.container.querySelector("#tf-nps-content");n&&(n.innerHTML=`\n        <div style="${this.getWarningStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n          <h3 style="${this.getTitleStyles()}">${t}</h3>\n          <p style="${this.getSubtitleStyles()}">${e}</p>\n        </div>\n      `)}showLimitReached(t){if(!this.container)return;const e=this.container.querySelector("#tf-nps-content");e&&(e.innerHTML=`\n        <div style="${this.getLimitReachedStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üö´</div>\n          <h3 style="${this.getTitleStyles()}">Limite Atingido</h3>\n          <p style="${this.getSubtitleStyles()}">${t}</p>\n          <button \n            onclick="window.open('/billing', '_blank')"\n            style="${this.getUpgradeButtonStyles()}"\n          >\n            Fazer Upgrade\n          </button>\n        </div>\n      `),setTimeout(()=>this.close(),5e3)}getWarningStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ffaa00;\n      background: rgba(255, 170, 0, 0.1);\n    "}getLimitReachedStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ff4444;\n      background: rgba(255, 68, 68, 0.1);\n    "}getUpgradeButtonStyles(){return"\n      margin-top: 20px;\n      padding: 12px 24px;\n      background: #ffd700;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-nps-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>\n          <h3 style="${this.getTitleStyles()}">Thank you!</h3>\n          <p style="${this.getSubtitleStyles()}">Your feedback helps us improve.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      position: relative;\n      box-shadow: 0 0 40px rgba(0, 255, 136, 0.1);\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getScaleContainerStyles(){return"\n      display: flex;\n      justify-content: center;\n      gap: 6px;\n      margin-bottom: 20px;\n      flex-wrap: wrap;\n    "}getRatingButtonStyles(t){const e=this.getScoreColor(t);return`\n      width: 36px;\n      height: 36px;\n      border: 1px solid ${e};\n      background: transparent;\n      color: ${e};\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `}getSelectedRatingButtonStyles(t){const e=this.getScoreColor(t);return`\n      width: 36px;\n      height: 36px;\n      border: 1px solid ${e};\n      background: ${e};\n      color: #000;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 0 10px ${e}80;\n    `}getScoreColor(t){return t<=6?"#ff4444":t<=8?"#ffaa00":"#00ff88"}getCommentSectionStyles(){return"\n      margin-bottom: 20px;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 80px;\n      padding: 12px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      background: #00ff88;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}}class n{constructor(t){this.container=null,this.titleInput=null,this.descriptionTextarea=null,this.options=t}open(){this.createModal(),this.attachEventListeners(),setTimeout(()=>this.titleInput?.focus(),100)}close(){this.container&&(this.container.remove(),this.container=null),this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-suggestion-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-suggestion-content",t.style.cssText=this.getModalStyles();const e=document.createElement("button");e.id="tf-suggestion-close",e.textContent="√ó",e.style.cssText=this.getCloseButtonStyles();const n=document.createElement("div");n.style.cssText=this.getHeaderStyles(),n.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">üí° Sugest√£o de Feature</h3>\n      <p style="${this.getSubtitleStyles()}">Tem uma ideia para melhorar nosso produto? Conta pra gente!</p>\n    `;const i=document.createElement("form");i.id="tf-suggestion-form",i.style.cssText=this.getFormStyles();const o=document.createElement("div");o.style.cssText=this.getFieldGroupStyles();const s=document.createElement("label");s.htmlFor="tf-suggestion-title",s.style.cssText=this.getLabelStyles(),s.innerHTML='T√≠tulo da sugest√£o <span style="color: #ff4444;">*</span>',this.titleInput=document.createElement("input"),this.titleInput.id="tf-suggestion-title",this.titleInput.type="text",this.titleInput.placeholder="Ex: Adicionar modo escuro",this.titleInput.required=!0,this.titleInput.style.cssText=this.getInputStyles(),o.appendChild(s),o.appendChild(this.titleInput);const r=document.createElement("div");r.style.cssText=this.getFieldGroupStyles();const a=document.createElement("label");a.htmlFor="tf-suggestion-description",a.style.cssText=this.getLabelStyles(),a.textContent="Descri√ß√£o (opcional)",this.descriptionTextarea=document.createElement("textarea"),this.descriptionTextarea.id="tf-suggestion-description",this.descriptionTextarea.placeholder="Descreva sua sugest√£o em detalhes...",this.descriptionTextarea.style.cssText=this.getTextareaStyles(),r.appendChild(a),r.appendChild(this.descriptionTextarea);const l=document.createElement("button");l.id="tf-suggestion-submit",l.type="submit",l.textContent="Enviar Sugest√£o",l.style.cssText=this.getSubmitButtonStyles(),i.appendChild(o),i.appendChild(r),i.appendChild(l),t.appendChild(e),t.appendChild(n),t.appendChild(i),this.container.appendChild(t),document.body.appendChild(this.container)}attachEventListeners(){if(!this.container)return;const t=this.container.querySelector("#tf-suggestion-form");t?.addEventListener("submit",t=>{t.preventDefault(),this.submit()});const e=this.container.querySelector("#tf-suggestion-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.container&&this.close()})}async submit(){if(!this.titleInput)return;const t=this.titleInput.value.trim(),e=this.descriptionTextarea?.value?.trim()||"";if(!t)return this.showError("O t√≠tulo √© obrigat√≥rio"),void this.titleInput?.focus();try{const n=await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"suggestion",title:t,content:e,page_url:window.location.href,user_agent:navigator.userAgent})});if(n.ok){const i=await n.json();if(i.warning)return this.showWarning(i.warning.message,i.warning.detail),void setTimeout(()=>this.close(),3e3);this.showThankYou(),this.options.onSubmit?.(t,e)}else if(429===n.status){const t=await n.json();"LIMIT_REACHED"===t.error?this.showLimitReached(t.message):this.showError("Falha ao enviar sugest√£o. Tente novamente.")}else console.error("Failed to submit suggestion"),this.showError("Falha ao enviar sugest√£o. Tente novamente.")}catch(t){console.error("Error submitting suggestion:",t),this.showError("Falha ao enviar sugest√£o. Tente novamente.")}}showWarning(t,e){if(!this.container)return;const n=this.container.querySelector("#tf-suggestion-content");n&&(n.innerHTML=`\n        <div style="${this.getWarningStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n          <h3 style="${this.getTitleStyles()}">${t}</h3>\n          <p style="${this.getSubtitleStyles()}">${e}</p>\n        </div>\n      `)}showLimitReached(t){if(!this.container)return;const e=this.container.querySelector("#tf-suggestion-content");e&&(e.innerHTML=`\n        <div style="${this.getLimitReachedStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üö´</div>\n          <h3 style="${this.getTitleStyles()}">Limite Atingido</h3>\n          <p style="${this.getSubtitleStyles()}">${t}</p>\n          <button \n            onclick="window.open('/billing', '_blank')"\n            style="${this.getUpgradeButtonStyles()}"\n          >\n            Fazer Upgrade\n          </button>\n        </div>\n      `),setTimeout(()=>this.close(),5e3)}showError(t){const e=this.container?.querySelector("#tf-suggestion-error");e?.remove();const n=document.createElement("div");n.id="tf-suggestion-error",n.style.cssText=this.getErrorStyles(),n.textContent=t;const i=this.container?.querySelector("#tf-suggestion-form");i?.insertBefore(n,i.firstChild)}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-suggestion-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>\n          <h3 style="${this.getTitleStyles()}">Obrigado!</h3>\n          <p style="${this.getSubtitleStyles()}">Sua sugest√£o foi enviada com sucesso.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      position: relative;\n      box-shadow: 0 0 40px rgba(0, 255, 136, 0.1);\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: color 0.2s ease;\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getFormStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    "}getFieldGroupStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    "}getLabelStyles(){return"\n      font-size: 14px;\n      font-weight: 500;\n      color: #fff;\n    "}getInputStyles(){return"\n      width: 100%;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      box-sizing: border-box;\n      font-family: inherit;\n      transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 120px;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n      transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      margin-top: 8px;\n      background: #00ff88;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getErrorStyles(){return"\n      padding: 12px 16px;\n      background: rgba(255, 68, 68, 0.1);\n      border: 1px solid #ff4444;\n      color: #ff4444;\n      font-size: 14px;\n      margin-bottom: 16px;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}getWarningStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ffaa00;\n      background: rgba(255, 170, 0, 0.1);\n    "}getLimitReachedStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ff4444;\n      background: rgba(255, 68, 68, 0.1);\n    "}getUpgradeButtonStyles(){return"\n      margin-top: 20px;\n      padding: 12px 24px;\n      background: #ffd700;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}}class i{constructor(t){this.container=null,this.titleInput=null,this.descriptionTextarea=null,this.selectedSeverity="medium",this.options=t}open(){this.createModal(),this.attachEventListeners(),setTimeout(()=>this.titleInput?.focus(),100)}close(){this.container&&(this.container.remove(),this.container=null),this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-bug-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-bug-content",t.style.cssText=this.getModalStyles();const e=document.createElement("button");e.id="tf-bug-close",e.textContent="√ó",e.style.cssText=this.getCloseButtonStyles();const n=document.createElement("div");n.style.cssText=this.getHeaderStyles(),n.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">üêõ Reportar Bug</h3>\n      <p style="${this.getSubtitleStyles()}">Encontrou algo errado? Nos ajude a corrigir!</p>\n    `;const i=document.createElement("form");i.id="tf-bug-form",i.style.cssText=this.getFormStyles();const o=document.createElement("div");o.style.cssText=this.getFieldGroupStyles();const s=document.createElement("label");s.style.cssText=this.getLabelStyles(),s.textContent="Gravidade do problema";const r=document.createElement("div");r.style.cssText=this.getSeverityContainerStyles();[{value:"low",label:"Baixa",color:"#00ff88"},{value:"medium",label:"M√©dia",color:"#ffaa00"},{value:"high",label:"Alta",color:"#ff6600"},{value:"critical",label:"Cr√≠tica",color:"#ff4444"}].forEach(t=>{const e=document.createElement("button");e.type="button",e.className="tf-bug-severity-btn",e.dataset.severity=t.value,e.textContent=t.label,e.style.cssText=this.getSeverityButtonStyles(t.value===this.selectedSeverity,t.color),r.appendChild(e)}),o.appendChild(s),o.appendChild(r);const a=document.createElement("div");a.style.cssText=this.getFieldGroupStyles();const l=document.createElement("label");l.htmlFor="tf-bug-title",l.style.cssText=this.getLabelStyles(),l.innerHTML='Resumo do problema <span style="color: #ff4444;">*</span>',this.titleInput=document.createElement("input"),this.titleInput.id="tf-bug-title",this.titleInput.type="text",this.titleInput.placeholder="Ex: Bot√£o de login n√£o funciona",this.titleInput.required=!0,this.titleInput.style.cssText=this.getInputStyles(),a.appendChild(l),a.appendChild(this.titleInput);const c=document.createElement("div");c.style.cssText=this.getFieldGroupStyles();const d=document.createElement("label");d.htmlFor="tf-bug-description",d.style.cssText=this.getLabelStyles(),d.textContent="Descri√ß√£o detalhada (como reproduzir)",this.descriptionTextarea=document.createElement("textarea"),this.descriptionTextarea.id="tf-bug-description",this.descriptionTextarea.placeholder="Descreva os passos para reproduzir o problema...",this.descriptionTextarea.style.cssText=this.getTextareaStyles(),c.appendChild(d),c.appendChild(this.descriptionTextarea);const p=document.createElement("button");p.id="tf-bug-submit",p.type="submit",p.textContent="Enviar Report",p.style.cssText=this.getSubmitButtonStyles(),i.appendChild(o),i.appendChild(a),i.appendChild(c),i.appendChild(p),t.appendChild(e),t.appendChild(n),t.appendChild(i),this.container.appendChild(t),document.body.appendChild(this.container)}attachEventListeners(){if(!this.container)return;this.container.querySelectorAll(".tf-bug-severity-btn").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.severity;this.selectSeverity(e)})});const t=this.container.querySelector("#tf-bug-form");t?.addEventListener("submit",t=>{t.preventDefault(),this.submit()});const e=this.container.querySelector("#tf-bug-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.container&&this.close()})}selectSeverity(t){this.selectedSeverity=t;const e=this.container?.querySelectorAll(".tf-bug-severity-btn"),n={low:"#00ff88",medium:"#ffaa00",high:"#ff6600",critical:"#ff4444"};e?.forEach(e=>{const i=e.dataset.severity,o=n[i];e.style.cssText=this.getSeverityButtonStyles(i===t,o)})}async submit(){if(!this.titleInput)return;const t=this.titleInput.value.trim(),e=this.descriptionTextarea?.value?.trim()||"";if(!t)return this.showError("O resumo do problema √© obrigat√≥rio"),void this.titleInput?.focus();try{const n=await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"bug",title:t,content:`[${this.selectedSeverity.toUpperCase()}] ${e}`,page_url:window.location.href,user_agent:navigator.userAgent})});if(n.ok){const i=await n.json();if(i.warning)return this.showWarning(i.warning.message,i.warning.detail),void setTimeout(()=>this.close(),3e3);this.showThankYou(),this.options.onSubmit?.(t,e,this.selectedSeverity)}else if(429===n.status){const t=await n.json();"LIMIT_REACHED"===t.error?this.showLimitReached(t.message):this.showError("Falha ao enviar report. Tente novamente.")}else 403===n.status?(console.error("[TinyFeedback] Domain not authorized. Check your allowed domains configuration."),this.showError("Dom√≠nio n√£o autorizado. Verifique as configura√ß√µes do projeto.")):(console.error("Failed to submit bug report"),this.showError("Falha ao enviar report. Tente novamente."))}catch(t){console.error("Error submitting bug report:",t),this.showError("Falha ao enviar report. Tente novamente.")}}showWarning(t,e){if(!this.container)return;const n=this.container.querySelector("#tf-bug-content");n&&(n.innerHTML=`\n        <div style="${this.getWarningStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n          <h3 style="${this.getTitleStyles()}">${t}</h3>\n          <p style="${this.getSubtitleStyles()}">${e}</p>\n        </div>\n      `)}showLimitReached(t){if(!this.container)return;const e=this.container.querySelector("#tf-bug-content");e&&(e.innerHTML=`\n        <div style="${this.getLimitReachedStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üö´</div>\n          <h3 style="${this.getTitleStyles()}">Limite Atingido</h3>\n          <p style="${this.getSubtitleStyles()}">${t}</p>\n          <button \n            onclick="window.open('/billing', '_blank')"\n            style="${this.getUpgradeButtonStyles()}"\n          >\n            Fazer Upgrade\n          </button>\n        </div>\n      `),setTimeout(()=>this.close(),5e3)}showError(t){const e=this.container?.querySelector("#tf-bug-error");e?.remove();const n=document.createElement("div");n.id="tf-bug-error",n.style.cssText=this.getErrorStyles(),n.textContent=t;const i=this.container?.querySelector("#tf-bug-form");i?.insertBefore(n,i.firstChild)}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-bug-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>\n          <h3 style="${this.getTitleStyles()}">Obrigado!</h3>\n          <p style="${this.getSubtitleStyles()}">Seu report foi enviado com sucesso.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      position: relative;\n      box-shadow: 0 0 40px rgba(255, 68, 68, 0.1);\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getFormStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    "}getFieldGroupStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    "}getLabelStyles(){return"\n      font-size: 14px;\n      font-weight: 500;\n      color: #fff;\n    "}getSeverityContainerStyles(){return"\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n    "}getSeverityButtonStyles(t,e){return`\n      flex: 1;\n      min-width: 60px;\n      padding: 8px 12px;\n      border: 1px solid ${e};\n      background: ${t?e:"transparent"};\n      color: ${t?"#000":e};\n      font-size: 12px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      ${t?`box-shadow: 0 0 10px ${e}80;`:""}\n    `}getInputStyles(){return"\n      width: 100%;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 120px;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      margin-top: 8px;\n      background: #ff4444;\n      color: #fff;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getErrorStyles(){return"\n      padding: 12px 16px;\n      background: rgba(255, 68, 68, 0.1);\n      border: 1px solid #ff4444;\n      color: #ff4444;\n      font-size: 14px;\n      margin-bottom: 16px;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}getWarningStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ffaa00;\n      background: rgba(255, 170, 0, 0.1);\n    "}getLimitReachedStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ff4444;\n      background: rgba(255, 68, 68, 0.1);\n    "}getUpgradeButtonStyles(){return"\n      margin-top: 20px;\n      padding: 12px 24px;\n      background: #ffd700;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}}class o{constructor(t={}){this.button=null,this.menuContainer=null,this.isMenuOpen=!1,this.handleOutsideClick=t=>{!this.menuContainer||this.menuContainer.contains(t.target)||this.button?.contains(t.target)||this.closeMenu()},this.options={position:t.position||"bottom-right",color:t.color||"#00ff88",text:t.text||"Feedback",onClick:t.onClick||(()=>{})}}mount(){this.button||(this.button=document.createElement("button"),this.button.id="tf-floating-btn",this.button.innerHTML=this.getButtonIcon(),this.button.style.cssText=this.getButtonStyles(),this.button.setAttribute("aria-label","Abrir feedback"),this.button.addEventListener("click",()=>this.toggleMenu()),document.body.appendChild(this.button))}unmount(){this.closeMenu(),this.button&&(this.button.remove(),this.button=null)}update(t){this.options={...this.options,...t},this.button&&(this.button.style.cssText=this.getButtonStyles())}onSelect(t){this.onSelectCallback=t}toggleMenu(){this.isMenuOpen?this.closeMenu():this.openMenu()}openMenu(){if(!this.button||this.isMenuOpen)return;this.isMenuOpen=!0,this.menuContainer=document.createElement("div"),this.menuContainer.id="tf-menu-container",this.menuContainer.style.cssText=this.getMenuContainerStyles();[{type:"nps",icon:"üìä",label:"Avalia√ß√£o",color:"#00ff88"},{type:"suggestion",icon:"üí°",label:"Sugest√£o",color:"#ffaa00"},{type:"bug",icon:"üêõ",label:"Reportar Bug",color:"#ff4444"}].forEach((t,e)=>{const n=document.createElement("button");n.className="tf-menu-item",n.style.cssText=this.getMenuItemStyles(t.color,e),n.innerHTML=`\n        <span style="font-size: 20px;">${t.icon}</span>\n        <span style="font-size: 14px; font-weight: 500;">${t.label}</span>\n      `,n.addEventListener("click",()=>{this.closeMenu(),this.onSelectCallback?.(t.type)}),this.menuContainer?.appendChild(n)}),document.body.appendChild(this.menuContainer),requestAnimationFrame(()=>{const t=this.menuContainer?.querySelectorAll(".tf-menu-item");t?.forEach((t,e)=>{setTimeout(()=>{t.style.opacity="1",t.style.transform="translateY(0)"},50*e)})}),document.addEventListener("click",this.handleOutsideClick)}closeMenu(){this.menuContainer&&(this.isMenuOpen=!1,this.menuContainer.remove(),this.menuContainer=null,document.removeEventListener("click",this.handleOutsideClick))}getButtonIcon(){return'\n      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M21 11.5C21.0034 12.8199 20.6951 14.1219 20.1 15.3C19.3944 16.7118 18.3098 17.8992 16.9674 18.7293C15.6251 19.5594 14.0782 19.9994 12.5 20C11.1801 20.0035 9.87812 19.6951 8.7 19.1L3 21L4.9 15.3C4.30493 14.1219 3.99656 12.8199 4 11.5C4.00061 9.92179 4.44061 8.37488 5.27072 7.03258C6.10083 5.69028 7.28825 4.6056 8.7 3.90003C9.87812 3.30496 11.1801 2.99659 12.5 3.00003H13C15.0843 3.11502 17.053 3.99479 18.5291 5.47089C20.0052 6.94699 20.885 8.91568 21 11V11.5Z" \n              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n      </svg>\n    '}getPositionStyles(){return{"bottom-right":"bottom: 24px; right: 24px;","bottom-left":"bottom: 24px; left: 24px;","top-right":"top: 24px; right: 24px;","top-left":"top: 24px; left: 24px;"}[this.options.position]}getButtonStyles(){return`\n      position: fixed;\n      ${this.getPositionStyles()}\n      width: 56px;\n      height: 56px;\n      border-radius: 0;\n      background: ${this.options.color};\n      color: #000;\n      border: none;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 4px 20px ${this.options.color}40;\n      z-index: 999998;\n      transition: all 0.3s ease;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    `}getMenuContainerStyles(){return`\n      position: fixed;\n      ${this.getMenuPositionStyles()}\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      z-index: 999997;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    `}getMenuPositionStyles(){return{"bottom-right":"bottom: 88px; right: 24px;","bottom-left":"bottom: 88px; left: 24px;","top-right":"top: 88px; right: 24px;","top-left":"top: 88px; left: 24px;"}[this.options.position]}getMenuItemStyles(t,e){return`\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      padding: 12px 16px;\n      background: #111;\n      border: 1px solid ${t}40;\n      color: #fff;\n      cursor: pointer;\n      min-width: 160px;\n      transition: all 0.2s ease;\n      opacity: 0;\n      transform: translateY(10px);\n    `}}class s{constructor(t){this.floatingButton=null,this.currentModal=null,this.appearance=null,this.isDomainValid=!0,this.initialized=!1,this.config={apiUrl:"",position:"bottom-right",color:"#00ff88",text:"Feedback",autoMount:!0,...t},this.config.apiUrl||(this.config.apiUrl=this.inferApiUrl()),this.config.projectId&&this.config.apiKey?this.config.autoMount&&this.init():console.error("[TinyFeedback] projectId and apiKey are required")}async init(){if(!this.initialized)try{if(await this.validateDomain(),!this.isDomainValid)return void console.error("[TinyFeedback] Domain not authorized. Widget will not be displayed.");await this.fetchAppearance(),this.mountButton(),this.initialized=!0}catch(t){console.error("[TinyFeedback] Failed to initialize widget:",t)}}async validateDomain(){try{const t=await fetch(`${this.config.apiUrl}/api/projects/${this.config.projectId}/domains`,{method:"GET",headers:{"X-API-Key":this.config.apiKey}});if(!t.ok)return 403===t.status?(console.error("[TinyFeedback] Domain not authorized"),void(this.isDomainValid=!1)):void(this.isDomainValid=!0);const e=await t.json();if(!e.data?.allowed_domains||0===e.data.allowed_domains.length)return void(this.isDomainValid=!0);const n=window.location.hostname;e.data.allowed_domains.some(t=>n===t||n.endsWith(`.${t}`))||(console.error(`[TinyFeedback] Domain "${n}" not in allowed domains:`,e.data.allowed_domains),this.isDomainValid=!1)}catch(t){console.warn("[TinyFeedback] Could not validate domain, allowing widget:",t),this.isDomainValid=!0}}async fetchAppearance(){try{const t=await fetch(`${this.config.apiUrl}/api/projects/${this.config.projectId}/widget-appearance`,{method:"GET",headers:{"X-API-Key":this.config.apiKey}});if(t.ok){const e=await t.json();this.appearance=e.data,this.appearance&&(this.config.color=this.appearance.widget_color||this.config.color,this.config.position=this.appearance.widget_position||this.config.position,this.config.text=this.appearance.widget_text||this.config.text)}}catch(t){console.warn("[TinyFeedback] Could not fetch appearance settings:",t)}}mountButton(){this.floatingButton=new o({position:this.config.position,color:this.config.color,text:this.config.text}),this.floatingButton.onSelect(t=>{this.openModal(t)}),this.floatingButton.mount()}openModal(t){this.closeCurrentModal();const o={projectId:this.config.projectId,apiKey:this.config.apiKey,apiUrl:this.config.apiUrl,onClose:()=>{this.currentModal=null}};switch(t){case"nps":this.currentModal=new e(o),this.currentModal.open();break;case"suggestion":this.currentModal=new n(o),this.currentModal.open();break;case"bug":this.currentModal=new i(o),this.currentModal.open()}}openNPS(){this.openModal("nps")}openSuggestion(){this.openModal("suggestion")}openBug(){this.openModal("bug")}closeCurrentModal(){this.currentModal?.close(),this.currentModal=null}close(){this.closeCurrentModal()}destroy(){this.close(),this.floatingButton?.unmount(),this.floatingButton=null,this.initialized=!1}update(t){this.config={...this.config,...t},this.floatingButton?.update({position:this.config.position,color:this.config.color,text:this.config.text})}inferApiUrl(){const t=document.querySelectorAll("script");for(let e=0;e<t.length;e++){const n=t[e].src;if(n.includes("tinyfeedback")){const t=new URL(n);return`${t.protocol}//${t.host}`}}return window.location.origin}static get version(){return"0.2.0"}}if("undefined"!=typeof window&&(window.TinyFeedback=s,window.__TF_CONFIG__?.projectId&&window.__TF_CONFIG__?.apiKey)){const t=new s(window.__TF_CONFIG__);window.__TF_INIT__=()=>t.init()}return t.BugModal=i,t.FloatingButton=o,t.NPSModal=e,t.SuggestionModal=n,t.TinyFeedbackWidget=s,t.default=s,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
