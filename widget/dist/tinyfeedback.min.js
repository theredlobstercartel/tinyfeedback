var TinyFeedback=function(t){"use strict";class e{constructor(t){this.container=null,this.selectedScore=null,this.options=t}open(){this.createModal(),this.attachEventListeners()}close(){this.container&&(this.container.remove(),this.container=null),this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-nps-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-nps-content",t.style.cssText=this.getModalStyles();const e=document.createElement("div");e.style.cssText=this.getHeaderStyles(),e.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">How likely are you to recommend us?</h3>\n      <p style="${this.getSubtitleStyles()}">Rate from 0 (not likely) to 10 (very likely)</p>\n    `;const n=document.createElement("div");n.id="tf-nps-scale",n.style.cssText=this.getScaleContainerStyles();for(let t=0;t<=10;t++){const e=this.createRatingButton(t);n.appendChild(e)}const i=document.createElement("div");i.id="tf-nps-comment-section",i.style.cssText=this.getCommentSectionStyles(),i.style.display="none",i.innerHTML=`\n      <textarea \n        id="tf-nps-comment" \n        placeholder="Tell us more about your experience (optional)"\n        style="${this.getTextareaStyles()}"\n      ></textarea>\n    `;const s=document.createElement("button");s.id="tf-nps-submit",s.textContent="Send Feedback",s.style.cssText=this.getSubmitButtonStyles(),s.style.display="none";const o=document.createElement("button");o.id="tf-nps-close",o.textContent="√ó",o.style.cssText=this.getCloseButtonStyles(),t.appendChild(o),t.appendChild(e),t.appendChild(n),t.appendChild(i),t.appendChild(s),this.container.appendChild(t),document.body.appendChild(this.container)}createRatingButton(t){const e=document.createElement("button");return e.className="tf-nps-rating-btn",e.dataset.score=t.toString(),e.textContent=t.toString(),e.style.cssText=this.getRatingButtonStyles(t),e}attachEventListeners(){if(!this.container)return;this.container.querySelectorAll(".tf-nps-rating-btn").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.dataset.score||"0");this.selectScore(e)})});const t=this.container.querySelector("#tf-nps-submit");t?.addEventListener("click",()=>this.submit());const e=this.container.querySelector("#tf-nps-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()})}selectScore(t){this.selectedScore=t;const e=this.container?.querySelectorAll(".tf-nps-rating-btn");e?.forEach(e=>{const n=parseInt(e.dataset.score||"0");e.style.cssText=n===t?this.getSelectedRatingButtonStyles(t):this.getRatingButtonStyles(n)});const n=this.container?.querySelector("#tf-nps-comment-section"),i=this.container?.querySelector("#tf-nps-submit");n&&(n.style.display="block"),i&&(i.style.display="block")}async submit(){if(null===this.selectedScore)return;const t=this.container?.querySelector("#tf-nps-comment"),e=t?.value?.trim();try{const t=await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"nps",nps_score:this.selectedScore,content:e||"",page_url:window.location.href,user_agent:navigator.userAgent})});if(t.ok){const n=await t.json();if(n.warning)return this.showWarning(n.warning.message,n.warning.detail),void setTimeout(()=>this.close(),3e3);this.showThankYou(),this.options.onSubmit?.(this.selectedScore,e)}else if(429===t.status){const e=await t.json();"LIMIT_REACHED"===e.error?this.showLimitReached(e.message):alert("Failed to submit feedback. Please try again.")}else console.error("Failed to submit NPS feedback"),alert("Failed to submit feedback. Please try again.")}catch(t){console.error("Error submitting NPS:",t),alert("Failed to submit feedback. Please try again.")}}showWarning(t,e){if(!this.container)return;const n=this.container.querySelector("#tf-nps-content");n&&(n.innerHTML=`\n        <div style="${this.getWarningStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n          <h3 style="${this.getTitleStyles()}">${t}</h3>\n          <p style="${this.getSubtitleStyles()}">${e}</p>\n        </div>\n      `)}showLimitReached(t){if(!this.container)return;const e=this.container.querySelector("#tf-nps-content");e&&(e.innerHTML=`\n        <div style="${this.getLimitReachedStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üö´</div>\n          <h3 style="${this.getTitleStyles()}">Limite Atingido</h3>\n          <p style="${this.getSubtitleStyles()}">${t}</p>\n          <button \n            onclick="window.open('/billing', '_blank')"\n            style="${this.getUpgradeButtonStyles()}"\n          >\n            Fazer Upgrade\n          </button>\n        </div>\n      `),setTimeout(()=>this.close(),5e3)}getWarningStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ffaa00;\n      background: rgba(255, 170, 0, 0.1);\n    "}getLimitReachedStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ff4444;\n      background: rgba(255, 68, 68, 0.1);\n    "}getUpgradeButtonStyles(){return"\n      margin-top: 20px;\n      padding: 12px 24px;\n      background: #ffd700;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-nps-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>\n          <h3 style="${this.getTitleStyles()}">Thank you!</h3>\n          <p style="${this.getSubtitleStyles()}">Your feedback helps us improve.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      position: relative;\n      box-shadow: 0 0 40px rgba(0, 255, 136, 0.1);\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getScaleContainerStyles(){return"\n      display: flex;\n      justify-content: center;\n      gap: 6px;\n      margin-bottom: 20px;\n      flex-wrap: wrap;\n    "}getRatingButtonStyles(t){const e=this.getScoreColor(t);return`\n      width: 36px;\n      height: 36px;\n      border: 1px solid ${e};\n      background: transparent;\n      color: ${e};\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `}getSelectedRatingButtonStyles(t){const e=this.getScoreColor(t);return`\n      width: 36px;\n      height: 36px;\n      border: 1px solid ${e};\n      background: ${e};\n      color: #000;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 0 10px ${e}80;\n    `}getScoreColor(t){return t<=6?"#ff4444":t<=8?"#ffaa00":"#00ff88"}getCommentSectionStyles(){return"\n      margin-bottom: 20px;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 80px;\n      padding: 12px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      background: #00ff88;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}}const n=["image/jpeg","image/png","image/gif","image/webp"];class i{constructor(t){this.attachments=[],this.fileInput=null,this.options={maxFileSize:5242880,allowedTypes:n,onAttachmentChange:()=>{},...t},this.createFileInput()}getAttachments(){return[...this.attachments]}getAttachmentCount(){return this.attachments.length}clearAttachments(){this.attachments.forEach(t=>{t.previewUrl&&t.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(t.previewUrl)}),this.attachments=[],this.notifyChange()}removeAttachment(t){const e=this.attachments.find(e=>e.id===t);e&&e.previewUrl.startsWith("blob:")&&URL.revokeObjectURL(e.previewUrl),this.attachments=this.attachments.filter(e=>e.id!==t),this.notifyChange()}async captureScreenshot(){try{if("mediaDevices"in navigator&&"getDisplayMedia"in navigator.mediaDevices){const t=await navigator.mediaDevices.getDisplayMedia({video:{cursor:"always"},audio:!1}),e=document.createElement("video");return e.srcObject=t,new Promise(n=>{e.onloadedmetadata=()=>{e.play(),setTimeout(()=>{const i=document.createElement("canvas");i.width=e.videoWidth,i.height=e.videoHeight;const s=i.getContext("2d");s?(s.drawImage(e,0,0),t.getTracks().forEach(t=>t.stop()),i.toBlob(t=>{if(t){const e=new File([t],`screenshot-${Date.now()}.png`,{type:"image/png"}),i=this.createAttachment(e,"screenshot");n(i)}else n(null)},"image/png")):(t.getTracks().forEach(t=>t.stop()),n(null))},500)},e.onerror=()=>{t.getTracks().forEach(t=>t.stop()),n(null)}})}return this.captureViewportScreenshot()}catch(t){return console.warn("[TinyFeedback] Screenshot capture failed:",t),null}}async captureViewportScreenshot(){try{const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)return null;const n=window.innerWidth,i=window.innerHeight;t.width=Math.min(n,1920),t.height=Math.min(i,1080);const s=window.getComputedStyle(document.body).backgroundColor;return e.fillStyle=s||"#ffffff",e.fillRect(0,0,t.width,t.height),e.fillStyle="#333333",e.font="14px sans-serif",e.fillText(`URL: ${window.location.href}`,10,30),e.fillText(`Captured: ${(new Date).toLocaleString()}`,10,50),e.fillText("(Viewport capture - for full page screenshot use browser tools)",10,70),new Promise(e=>{t.toBlob(t=>{if(t){const n=new File([t],`viewport-${Date.now()}.png`,{type:"image/png"}),i=this.createAttachment(n,"screenshot");e(i)}else e(null)},"image/png",.8)})}catch(t){return console.warn("[TinyFeedback] Viewport capture failed:",t),null}}triggerFileUpload(){this.fileInput?.click()}handleFileSelect(t){const e=t.target,n=e.files;n&&0!==n.length&&(Array.from(n).forEach(t=>{const e=this.validateFile(t);if(e)return void console.warn(`[TinyFeedback] File rejected: ${e}`);const n=this.createAttachment(t,"upload");this.attachments.push(n)}),this.notifyChange(),e.value="")}validateFile(t){return t.size>this.options.maxFileSize?`File too large (max ${this.formatFileSize(this.options.maxFileSize)})`:this.options.allowedTypes.includes(t.type)?null:`Invalid file type (allowed: ${this.options.allowedTypes.join(", ")})`}createAttachment(t,e){return{id:`att-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:t,previewUrl:URL.createObjectURL(t),type:e,name:t.name,size:t.size}}createFileInput(){this.fileInput=document.createElement("input"),this.fileInput.type="file",this.fileInput.accept=this.options.allowedTypes.join(","),this.fileInput.multiple=!0,this.fileInput.style.display="none",this.fileInput.addEventListener("change",t=>this.handleFileSelect(t)),document.body.appendChild(this.fileInput)}notifyChange(){this.options.onAttachmentChange([...this.attachments])}formatFileSize(t){if(0===t)return"0 Bytes";const e=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,e)).toFixed(2))+" "+["Bytes","KB","MB","GB"][e]}async uploadAttachments(){const t=[],e=[];for(const n of this.attachments)if(n.file)try{const i=new FormData;i.append("file",n.file),i.append("projectId",this.options.projectId),i.append("type",n.type);const s=await fetch(`${this.options.apiUrl}/api/widget/upload`,{method:"POST",headers:{"X-API-Key":this.options.apiKey},body:i});if(s.ok){const e=await s.json();e.url&&t.push(e.url)}else{const t=await s.json().catch(()=>({error:"Upload failed"}));e.push(`${n.name}: ${t.error||"Upload failed"}`)}}catch(t){e.push(`${n.name}: Network error`)}return{urls:t,errors:e}}destroy(){this.clearAttachments(),this.fileInput&&(this.fileInput.remove(),this.fileInput=null)}}class s{constructor(t){this.attachmentContainer=null,this.buttonsContainer=null,this.errorMessage=null,this.container=t.container,this.options={maxAttachments:5,onAttachmentsChange:()=>{},...t},this.handler=new i({apiUrl:t.apiUrl,apiKey:t.apiKey,projectId:t.projectId,onAttachmentChange:t=>{this.renderAttachments(),this.options.onAttachmentsChange(t),this.updateButtonStates()}}),this.createUI()}createUI(){const t=document.createElement("div");t.className="tf-attachment-wrapper",t.style.cssText=this.getWrapperStyles();const e=document.createElement("label");e.textContent="Anexos (m√°x 5MB cada)",e.style.cssText=this.getLabelStyles(),this.buttonsContainer=document.createElement("div"),this.buttonsContainer.style.cssText=this.getButtonsContainerStyles();const n=document.createElement("button");n.type="button",n.className="tf-attachment-btn tf-screenshot-btn",n.innerHTML="üì∏ Capturar Tela",n.style.cssText=this.getButtonStyles(),n.addEventListener("click",()=>this.handleScreenshot());const i=document.createElement("button");i.type="button",i.className="tf-attachment-btn tf-upload-btn",i.innerHTML="üìé Anexar Arquivo",i.style.cssText=this.getButtonStyles(),i.addEventListener("click",()=>this.handler.triggerFileUpload()),this.buttonsContainer.appendChild(n),this.buttonsContainer.appendChild(i),this.errorMessage=document.createElement("div"),this.errorMessage.style.cssText=this.getErrorStyles(),this.errorMessage.style.display="none",this.attachmentContainer=document.createElement("div"),this.attachmentContainer.className="tf-attachment-grid",this.attachmentContainer.style.cssText=this.getAttachmentGridStyles(),t.appendChild(e),t.appendChild(this.buttonsContainer),t.appendChild(this.errorMessage),t.appendChild(this.attachmentContainer),this.container.appendChild(t)}async handleScreenshot(){if(this.clearError(),this.handler.getAttachmentCount()>=this.options.maxAttachments)return void this.showError(`Limite de ${this.options.maxAttachments} anexos atingido`);const t=this.buttonsContainer?.querySelector(".tf-screenshot-btn");t&&(t.disabled=!0,t.textContent="Capturando...");try{const t=await this.handler.captureScreenshot();t?(this.handler.getAttachments().push(t),this.renderAttachments(),this.options.onAttachmentsChange(this.handler.getAttachments())):this.showError("N√£o foi poss√≠vel capturar a tela. Tente anexar um arquivo manualmente.")}catch(t){this.showError("Erro ao capturar tela")}finally{t&&(t.disabled=!1,t.innerHTML="üì∏ Capturar Tela"),this.updateButtonStates()}}renderAttachments(){if(!this.attachmentContainer)return;this.attachmentContainer.innerHTML="";this.handler.getAttachments().forEach(t=>{const e=this.createAttachmentItem(t);this.attachmentContainer.appendChild(e)})}createAttachmentItem(t){const e=document.createElement("div");e.className="tf-attachment-item",e.style.cssText=this.getAttachmentItemStyles(),e.dataset.id=t.id;const n=document.createElement("img");n.src=t.previewUrl,n.alt=t.name,n.style.cssText=this.getAttachmentImageStyles();const i=document.createElement("div");i.style.cssText=this.getAttachmentOverlayStyles();const s=document.createElement("span");s.textContent=this.truncateFilename(t.name),s.style.cssText=this.getAttachmentNameStyles();const o=document.createElement("span");o.textContent=this.handler.formatFileSize(t.size),o.style.cssText=this.getAttachmentSizeStyles();const r=document.createElement("button");return r.type="button",r.innerHTML="√ó",r.style.cssText=this.getRemoveButtonStyles(),r.addEventListener("click",e=>{e.stopPropagation(),this.handler.removeAttachment(t.id)}),i.appendChild(s),i.appendChild(o),i.appendChild(r),e.appendChild(n),e.appendChild(i),e}updateButtonStates(){const t=this.buttonsContainer?.querySelectorAll(".tf-attachment-btn"),e=this.handler.getAttachmentCount()>=this.options.maxAttachments;t?.forEach(t=>{t.disabled=e,t.style.opacity=e?"0.5":"1",t.style.cursor=e?"not-allowed":"pointer"})}showError(t){this.errorMessage&&(this.errorMessage.textContent=t,this.errorMessage.style.display="block",setTimeout(()=>this.clearError(),5e3))}clearError(){this.errorMessage&&(this.errorMessage.textContent="",this.errorMessage.style.display="none")}truncateFilename(t,e=15){if(t.length<=e)return t;const n=t.split(".").pop();return`${t.substring(0,e-4)}...${n}`}getHandler(){return this.handler}getAttachments(){return this.handler.getAttachments()}destroy(){this.handler.destroy()}getWrapperStyles(){return"\n      margin-top: 16px;\n      padding-top: 16px;\n      border-top: 1px solid #333;\n    "}getLabelStyles(){return"\n      display: block;\n      font-size: 14px;\n      font-weight: 500;\n      color: #fff;\n      margin-bottom: 8px;\n    "}getButtonsContainerStyles(){return"\n      display: flex;\n      gap: 8px;\n      margin-bottom: 12px;\n    "}getButtonStyles(){return"\n      flex: 1;\n      padding: 10px 12px;\n      background: #1a1a1a;\n      border: 1px solid #333;\n      color: #fff;\n      font-size: 13px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 6px;\n    "}getErrorStyles(){return"\n      padding: 8px 12px;\n      background: rgba(255, 68, 68, 0.1);\n      border: 1px solid #ff4444;\n      color: #ff4444;\n      font-size: 13px;\n      margin-bottom: 12px;\n      border-radius: 4px;\n    "}getAttachmentGridStyles(){return"\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n      gap: 8px;\n    "}getAttachmentItemStyles(){return"\n      position: relative;\n      aspect-ratio: 1;\n      border-radius: 8px;\n      overflow: hidden;\n      border: 1px solid #333;\n      background: #111;\n    "}getAttachmentImageStyles(){return"\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n    "}getAttachmentOverlayStyles(){return"\n      position: absolute;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      background: linear-gradient(transparent, rgba(0,0,0,0.9));\n      padding: 8px;\n      display: flex;\n      flex-direction: column;\n      gap: 2px;\n    "}getAttachmentNameStyles(){return"\n      font-size: 11px;\n      color: #fff;\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    "}getAttachmentSizeStyles(){return"\n      font-size: 10px;\n      color: #888;\n    "}getRemoveButtonStyles(){return"\n      position: absolute;\n      top: 4px;\n      right: 4px;\n      width: 20px;\n      height: 20px;\n      background: rgba(255, 68, 68, 0.9);\n      border: none;\n      border-radius: 50%;\n      color: #fff;\n      font-size: 14px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: background 0.2s ease;\n    "}}class o{constructor(t){this.container=null,this.titleInput=null,this.descriptionTextarea=null,this.attachmentUI=null,this.options=t}open(){this.createModal(),this.attachEventListeners(),setTimeout(()=>this.titleInput?.focus(),100)}close(){this.container&&(this.container.remove(),this.container=null),this.attachmentUI?.destroy(),this.attachmentUI=null,this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-suggestion-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-suggestion-content",t.style.cssText=this.getModalStyles();const e=document.createElement("button");e.id="tf-suggestion-close",e.textContent="√ó",e.style.cssText=this.getCloseButtonStyles();const n=document.createElement("div");n.style.cssText=this.getHeaderStyles(),n.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">üí° Sugest√£o de Feature</h3>\n      <p style="${this.getSubtitleStyles()}">Tem uma ideia para melhorar nosso produto? Conta pra gente!</p>\n    `;const i=document.createElement("form");i.id="tf-suggestion-form",i.style.cssText=this.getFormStyles();const o=document.createElement("div");o.style.cssText=this.getFieldGroupStyles();const r=document.createElement("label");r.htmlFor="tf-suggestion-title",r.style.cssText=this.getLabelStyles(),r.innerHTML='T√≠tulo da sugest√£o <span style="color: #ff4444;">*</span>',this.titleInput=document.createElement("input"),this.titleInput.id="tf-suggestion-title",this.titleInput.type="text",this.titleInput.placeholder="Ex: Adicionar modo escuro",this.titleInput.required=!0,this.titleInput.style.cssText=this.getInputStyles(),o.appendChild(r),o.appendChild(this.titleInput);const a=document.createElement("div");a.style.cssText=this.getFieldGroupStyles();const l=document.createElement("label");l.htmlFor="tf-suggestion-description",l.style.cssText=this.getLabelStyles(),l.textContent="Descri√ß√£o (opcional)",this.descriptionTextarea=document.createElement("textarea"),this.descriptionTextarea.id="tf-suggestion-description",this.descriptionTextarea.placeholder="Descreva sua sugest√£o em detalhes...",this.descriptionTextarea.style.cssText=this.getTextareaStyles(),a.appendChild(l),a.appendChild(this.descriptionTextarea);const c=document.createElement("div");c.id="tf-suggestion-attachments";const d=document.createElement("button");d.id="tf-suggestion-submit",d.type="submit",d.textContent="Enviar Sugest√£o",d.style.cssText=this.getSubmitButtonStyles(),i.appendChild(o),i.appendChild(a),i.appendChild(c),i.appendChild(d),t.appendChild(e),t.appendChild(n),t.appendChild(i),this.container.appendChild(t),document.body.appendChild(this.container),this.attachmentUI=new s({container:c,apiUrl:this.options.apiUrl,apiKey:this.options.apiKey,projectId:this.options.projectId,maxAttachments:5})}attachEventListeners(){if(!this.container)return;const t=this.container.querySelector("#tf-suggestion-form");t?.addEventListener("submit",t=>{t.preventDefault(),this.submit()});const e=this.container.querySelector("#tf-suggestion-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.container&&this.close()})}async submit(){if(!this.titleInput)return;const t=this.titleInput.value.trim(),e=this.descriptionTextarea?.value?.trim()||"";if(!t)return this.showError("O t√≠tulo √© obrigat√≥rio"),void this.titleInput?.focus();const n=this.container?.querySelector("#tf-suggestion-submit");n&&(n.disabled=!0,n.textContent="Enviando...");try{let n=[];if(this.attachmentUI&&this.attachmentUI.getAttachments().length>0){const t=this.attachmentUI.getHandler(),{urls:e,errors:i}=await t.uploadAttachments();i.length>0&&console.warn("[TinyFeedback] Some attachments failed:",i),n=e}const i=await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"suggestion",title:t,content:e,page_url:window.location.href,user_agent:navigator.userAgent,screenshot_url:n.length>0?n[0]:null,attachment_urls:n})});if(i.ok){const s=await i.json();if(s.warning)return this.showWarning(s.warning.message,s.warning.detail),void setTimeout(()=>this.close(),3e3);this.showThankYou(),this.options.onSubmit?.(t,e||void 0,n)}else if(429===i.status){const t=await i.json();"LIMIT_REACHED"===t.error?this.showLimitReached(t.message):this.showError("Falha ao enviar sugest√£o. Tente novamente.")}else console.error("Failed to submit suggestion"),this.showError("Falha ao enviar sugest√£o. Tente novamente.")}catch(t){console.error("Error submitting suggestion:",t),this.showError("Falha ao enviar sugest√£o. Tente novamente.")}finally{n&&(n.disabled=!1,n.textContent="Enviar Sugest√£o")}}showWarning(t,e){if(!this.container)return;const n=this.container.querySelector("#tf-suggestion-content");n&&(n.innerHTML=`\n        <div style="${this.getWarningStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n          <h3 style="${this.getTitleStyles()}">${t}</h3>\n          <p style="${this.getSubtitleStyles()}">${e}</p>\n        </div>\n      `)}showLimitReached(t){if(!this.container)return;const e=this.container.querySelector("#tf-suggestion-content");e&&(e.innerHTML=`\n        <div style="${this.getLimitReachedStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üö´</div>\n          <h3 style="${this.getTitleStyles()}">Limite Atingido</h3>\n          <p style="${this.getSubtitleStyles()}">${t}</p>\n          <button \n            onclick="window.open('/billing', '_blank')"\n            style="${this.getUpgradeButtonStyles()}"\n          >\n            Fazer Upgrade\n          </button>\n        </div>\n      `),setTimeout(()=>this.close(),5e3)}showError(t){const e=this.container?.querySelector("#tf-suggestion-error");e?.remove();const n=document.createElement("div");n.id="tf-suggestion-error",n.style.cssText=this.getErrorStyles(),n.textContent=t;const i=this.container?.querySelector("#tf-suggestion-form");i?.insertBefore(n,i.firstChild)}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-suggestion-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>\n          <h3 style="${this.getTitleStyles()}">Obrigado!</h3>\n          <p style="${this.getSubtitleStyles()}">Sua sugest√£o foi enviada com sucesso.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      max-height: 90vh;\n      overflow-y: auto;\n      position: relative;\n      box-shadow: 0 0 40px rgba(0, 255, 136, 0.1);\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: color 0.2s ease;\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getFormStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    "}getFieldGroupStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    "}getLabelStyles(){return"\n      font-size: 14px;\n      font-weight: 500;\n      color: #fff;\n    "}getInputStyles(){return"\n      width: 100%;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      box-sizing: border-box;\n      font-family: inherit;\n      transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 120px;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n      transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      margin-top: 8px;\n      background: #00ff88;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getErrorStyles(){return"\n      padding: 12px 16px;\n      background: rgba(255, 68, 68, 0.1);\n      border: 1px solid #ff4444;\n      color: #ff4444;\n      font-size: 14px;\n      margin-bottom: 16px;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}getWarningStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ffaa00;\n      background: rgba(255, 170, 0, 0.1);\n    "}getLimitReachedStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ff4444;\n      background: rgba(255, 68, 68, 0.1);\n    "}getUpgradeButtonStyles(){return"\n      margin-top: 20px;\n      padding: 12px 24px;\n      background: #ffd700;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}}class r{constructor(t){this.container=null,this.titleInput=null,this.descriptionTextarea=null,this.selectedSeverity="medium",this.attachmentUI=null,this.options=t}open(){this.createModal(),this.attachEventListeners(),setTimeout(()=>this.titleInput?.focus(),100)}close(){this.container&&(this.container.remove(),this.container=null),this.attachmentUI?.destroy(),this.attachmentUI=null,this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-bug-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-bug-content",t.style.cssText=this.getModalStyles();const e=document.createElement("button");e.id="tf-bug-close",e.textContent="√ó",e.style.cssText=this.getCloseButtonStyles();const n=document.createElement("div");n.style.cssText=this.getHeaderStyles(),n.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">üêõ Reportar Bug</h3>\n      <p style="${this.getSubtitleStyles()}">Encontrou algo errado? Nos ajude a corrigir!</p>\n    `;const i=document.createElement("form");i.id="tf-bug-form",i.style.cssText=this.getFormStyles();const o=document.createElement("div");o.style.cssText=this.getFieldGroupStyles();const r=document.createElement("label");r.style.cssText=this.getLabelStyles(),r.textContent="Gravidade do problema";const a=document.createElement("div");a.style.cssText=this.getSeverityContainerStyles();[{value:"low",label:"Baixa",color:"#00ff88"},{value:"medium",label:"M√©dia",color:"#ffaa00"},{value:"high",label:"Alta",color:"#ff6600"},{value:"critical",label:"Cr√≠tica",color:"#ff4444"}].forEach(t=>{const e=document.createElement("button");e.type="button",e.className="tf-bug-severity-btn",e.dataset.severity=t.value,e.textContent=t.label,e.style.cssText=this.getSeverityButtonStyles(t.value===this.selectedSeverity,t.color),a.appendChild(e)}),o.appendChild(r),o.appendChild(a);const l=document.createElement("div");l.style.cssText=this.getFieldGroupStyles();const c=document.createElement("label");c.htmlFor="tf-bug-title",c.style.cssText=this.getLabelStyles(),c.innerHTML='Resumo do problema <span style="color: #ff4444;">*</span>',this.titleInput=document.createElement("input"),this.titleInput.id="tf-bug-title",this.titleInput.type="text",this.titleInput.placeholder="Ex: Bot√£o de login n√£o funciona",this.titleInput.required=!0,this.titleInput.style.cssText=this.getInputStyles(),l.appendChild(c),l.appendChild(this.titleInput);const d=document.createElement("div");d.style.cssText=this.getFieldGroupStyles();const h=document.createElement("label");h.htmlFor="tf-bug-description",h.style.cssText=this.getLabelStyles(),h.textContent="Descri√ß√£o detalhada (como reproduzir)",this.descriptionTextarea=document.createElement("textarea"),this.descriptionTextarea.id="tf-bug-description",this.descriptionTextarea.placeholder="Descreva os passos para reproduzir o problema...",this.descriptionTextarea.style.cssText=this.getTextareaStyles(),d.appendChild(h),d.appendChild(this.descriptionTextarea);const p=document.createElement("div");p.id="tf-bug-attachments";const u=document.createElement("button");u.id="tf-bug-submit",u.type="submit",u.textContent="Enviar Report",u.style.cssText=this.getSubmitButtonStyles(),i.appendChild(o),i.appendChild(l),i.appendChild(d),i.appendChild(p),i.appendChild(u),t.appendChild(e),t.appendChild(n),t.appendChild(i),this.container.appendChild(t),document.body.appendChild(this.container),this.attachmentUI=new s({container:p,apiUrl:this.options.apiUrl,apiKey:this.options.apiKey,projectId:this.options.projectId,maxAttachments:5})}attachEventListeners(){if(!this.container)return;this.container.querySelectorAll(".tf-bug-severity-btn").forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.severity;this.selectSeverity(e)})});const t=this.container.querySelector("#tf-bug-form");t?.addEventListener("submit",t=>{t.preventDefault(),this.submit()});const e=this.container.querySelector("#tf-bug-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.container&&this.close()})}selectSeverity(t){this.selectedSeverity=t;const e=this.container?.querySelectorAll(".tf-bug-severity-btn"),n={low:"#00ff88",medium:"#ffaa00",high:"#ff6600",critical:"#ff4444"};e?.forEach(e=>{const i=e.dataset.severity,s=n[i];e.style.cssText=this.getSeverityButtonStyles(i===t,s)})}async submit(){if(!this.titleInput)return;const t=this.titleInput.value.trim(),e=this.descriptionTextarea?.value?.trim()||"";if(!t)return this.showError("O resumo do problema √© obrigat√≥rio"),void this.titleInput?.focus();const n=this.container?.querySelector("#tf-bug-submit");n&&(n.disabled=!0,n.textContent="Enviando...");try{let n=[];if(this.attachmentUI&&this.attachmentUI.getAttachments().length>0){const t=this.attachmentUI.getHandler(),{urls:e,errors:i}=await t.uploadAttachments();i.length>0&&console.warn("[TinyFeedback] Some attachments failed:",i),n=e}const i=await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"bug",title:t,content:`[${this.selectedSeverity.toUpperCase()}] ${e}`,page_url:window.location.href,user_agent:navigator.userAgent,screenshot_url:n.length>0?n[0]:null,attachment_urls:n})});if(i.ok){const s=await i.json();if(s.warning)return this.showWarning(s.warning.message,s.warning.detail),void setTimeout(()=>this.close(),3e3);this.showThankYou(),this.options.onSubmit?.(t,e,this.selectedSeverity,n)}else if(429===i.status){const t=await i.json();"LIMIT_REACHED"===t.error?this.showLimitReached(t.message):this.showError("Falha ao enviar report. Tente novamente.")}else 403===i.status?(console.error("[TinyFeedback] Domain not authorized. Check your allowed domains configuration."),this.showError("Dom√≠nio n√£o autorizado. Verifique as configura√ß√µes do projeto.")):(console.error("Failed to submit bug report"),this.showError("Falha ao enviar report. Tente novamente."))}catch(t){console.error("Error submitting bug report:",t),this.showError("Falha ao enviar report. Tente novamente.")}finally{n&&(n.disabled=!1,n.textContent="Enviar Report")}}showWarning(t,e){if(!this.container)return;const n=this.container.querySelector("#tf-bug-content");n&&(n.innerHTML=`\n        <div style="${this.getWarningStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">‚ö†Ô∏è</div>\n          <h3 style="${this.getTitleStyles()}">${t}</h3>\n          <p style="${this.getSubtitleStyles()}">${e}</p>\n        </div>\n      `)}showLimitReached(t){if(!this.container)return;const e=this.container.querySelector("#tf-bug-content");e&&(e.innerHTML=`\n        <div style="${this.getLimitReachedStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üö´</div>\n          <h3 style="${this.getTitleStyles()}">Limite Atingido</h3>\n          <p style="${this.getSubtitleStyles()}">${t}</p>\n          <button \n            onclick="window.open('/billing', '_blank')"\n            style="${this.getUpgradeButtonStyles()}"\n          >\n            Fazer Upgrade\n          </button>\n        </div>\n      `),setTimeout(()=>this.close(),5e3)}showError(t){const e=this.container?.querySelector("#tf-bug-error");e?.remove();const n=document.createElement("div");n.id="tf-bug-error",n.style.cssText=this.getErrorStyles(),n.textContent=t;const i=this.container?.querySelector("#tf-bug-form");i?.insertBefore(n,i.firstChild)}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-bug-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>\n          <h3 style="${this.getTitleStyles()}">Obrigado!</h3>\n          <p style="${this.getSubtitleStyles()}">Seu report foi enviado com sucesso.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      max-height: 90vh;\n      overflow-y: auto;\n      position: relative;\n      box-shadow: 0 0 40px rgba(255, 68, 68, 0.1);\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getFormStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    "}getFieldGroupStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    "}getLabelStyles(){return"\n      font-size: 14px;\n      font-weight: 500;\n      color: #fff;\n    "}getSeverityContainerStyles(){return"\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n    "}getSeverityButtonStyles(t,e){return`\n      flex: 1;\n      min-width: 60px;\n      padding: 8px 12px;\n      border: 1px solid ${e};\n      background: ${t?e:"transparent"};\n      color: ${t?"#000":e};\n      font-size: 12px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      ${t?`box-shadow: 0 0 10px ${e}80;`:""}\n    `}getInputStyles(){return"\n      width: 100%;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 120px;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      margin-top: 8px;\n      background: #ff4444;\n      color: #fff;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getErrorStyles(){return"\n      padding: 12px 16px;\n      background: rgba(255, 68, 68, 0.1);\n      border: 1px solid #ff4444;\n      color: #ff4444;\n      font-size: 14px;\n      margin-bottom: 16px;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}getWarningStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ffaa00;\n      background: rgba(255, 170, 0, 0.1);\n    "}getLimitReachedStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n      border: 1px solid #ff4444;\n      background: rgba(255, 68, 68, 0.1);\n    "}getUpgradeButtonStyles(){return"\n      margin-top: 20px;\n      padding: 12px 24px;\n      background: #ffd700;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}}class a{constructor(t){this.npsModal=null,this.suggestionModal=null,this.bugModal=null,this.floatingButton=null,this.menuContainer=null,this.isMenuOpen=!1,this.isReducedMotion=!1,this.keydownHandler=null,this.handleOutsideClick=t=>{this.menuContainer&&!this.menuContainer.contains(t.target)&&this.floatingButton&&!this.floatingButton.contains(t.target)&&this.closeMenu()},this.config={apiUrl:"",position:"bottom-right",primaryColor:"#3b82f6",buttonText:"Feedback",...t},this.isReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",t=>{this.isReducedMotion=t.matches,this.updateAnimationStyles()}),this.config.apiUrl||(this.config.apiUrl=this.inferApiUrl())}init(){this.validateDomain().then(t=>{t?this.fetchAppearance().then(t=>{t&&(this.config.primaryColor=t.primary_color,this.config.buttonText=t.button_text,this.config.position=t.position),this.createFloatingButton()}):console.error("[TinyFeedback] Domain not authorized. Widget will not load.")})}async validateDomain(){try{const t=window.location.origin;return(await fetch(`${this.config.apiUrl}/api/widget/validate`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.config.apiKey},body:JSON.stringify({projectId:this.config.projectId,domain:t})})).ok}catch(t){return console.warn("[TinyFeedback] Domain validation failed:",t),!0}}async fetchAppearance(){try{const t=await fetch(`${this.config.apiUrl}/api/projects/${this.config.projectId}/widget-appearance`,{headers:{"X-API-Key":this.config.apiKey}});if(t.ok)return await t.json()}catch(t){console.warn("[TinyFeedback] Failed to fetch appearance:",t)}return null}createFloatingButton(){const t=document.createElement("button");t.id="tinyfeedback-button",t.innerHTML=this.config.buttonText,t.style.cssText=this.getButtonStyles(),t.setAttribute("aria-label","Abrir menu de feedback"),t.setAttribute("aria-haspopup","menu"),t.setAttribute("aria-expanded","false"),t.setAttribute("type","button"),t.addEventListener("click",()=>this.toggleMenu()),t.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.toggleMenu())}),document.body.appendChild(t),this.floatingButton=t}getButtonStyles(){return`\n      position: fixed;\n      ${this.getPositionStyles()}\n      padding: 12px 20px;\n      background: ${this.config.primaryColor};\n      color: white;\n      border: none;\n      border-radius: 9999px;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      z-index: 2147483646;\n      transition: transform ${this.isReducedMotion?"0s":"0.2s"}, box-shadow ${this.isReducedMotion?"0s":"0.2s"};\n      outline-offset: 2px;\n    `}getPositionStyles(){const t={"bottom-right":"bottom: 20px; right: 20px;","bottom-left":"bottom: 20px; left: 20px;","top-right":"top: 20px; right: 20px;","top-left":"top: 20px; left: 20px;"};return t[this.config.position]||t["bottom-right"]}toggleMenu(){this.isMenuOpen?this.closeMenu():this.openMenu()}openMenu(){if(!this.floatingButton)return;this.floatingButton.setAttribute("aria-expanded","true");const t=document.createElement("div");t.id="tinyfeedback-menu",t.setAttribute("role","menu"),t.setAttribute("aria-label","Op√ß√µes de feedback"),t.style.cssText=this.getMenuStyles(),t.innerHTML=`\n      <div style="padding: 8px;">\n        <button class="tf-menu-item" data-type="nps" role="menuitem" style="${this.getMenuItemStyles()}" tabindex="-1">\n          <span style="font-size: 18px; margin-right: 8px;" aria-hidden="true">üìä</span>\n          <span>Avalia√ß√£o (NPS)</span>\n          <span class="visually-hidden">, Abre modal de avalia√ß√£o</span>\n        </button>\n        <button class="tf-menu-item" data-type="suggestion" role="menuitem" style="${this.getMenuItemStyles()}" tabindex="-1">\n          <span style="font-size: 18px; margin-right: 8px;" aria-hidden="true">üí°</span>\n          <span>Sugest√£o</span>\n          <span class="visually-hidden">, Abre modal de sugest√£o</span>\n        </button>\n        <button class="tf-menu-item" data-type="bug" role="menuitem" style="${this.getMenuItemStyles()}" tabindex="-1">\n          <span style="font-size: 18px; margin-right: 8px;" aria-hidden="true">üêõ</span>\n          <span>Reportar Bug</span>\n          <span class="visually-hidden">, Abre modal de bug</span>\n        </button>\n      </div>\n    `,document.body.appendChild(t),this.menuContainer=t,this.isMenuOpen=!0,this.setupMenuKeyboardNavigation();const e=t.querySelector('[role="menuitem"]');e&&setTimeout(()=>e.focus(),this.isReducedMotion?0:50),t.querySelectorAll(".tf-menu-item").forEach(t=>{t.addEventListener("click",t=>{const e=t.currentTarget.getAttribute("data-type");this.handleMenuSelection(e)})}),setTimeout(()=>{document.addEventListener("click",this.handleOutsideClick)},0)}setupMenuKeyboardNavigation(){if(!this.menuContainer)return;const t=this.menuContainer.querySelectorAll('[role="menuitem"]');this.keydownHandler=e=>{const n=document.activeElement,i=Array.from(t).indexOf(n);switch(e.key){case"ArrowDown":e.preventDefault();const n=i<t.length-1?i+1:0;t[n].focus();break;case"ArrowUp":e.preventDefault();const s=i>0?i-1:t.length-1;t[s].focus();break;case"Home":e.preventDefault(),t[0].focus();break;case"End":e.preventDefault(),t[t.length-1].focus();break;case"Escape":e.preventDefault(),this.closeMenu(),this.floatingButton?.focus();break;case"Tab":e.preventDefault(),this.closeMenu()}},this.menuContainer.addEventListener("keydown",this.keydownHandler)}closeMenu(){this.menuContainer&&(this.keydownHandler&&this.menuContainer.removeEventListener("keydown",this.keydownHandler),this.isReducedMotion?(this.menuContainer.remove(),this.menuContainer=null):(this.menuContainer.style.opacity="0",this.menuContainer.style.transform="scale(0.95)",setTimeout(()=>{this.menuContainer?.remove(),this.menuContainer=null},200))),this.floatingButton?.setAttribute("aria-expanded","false"),this.isMenuOpen=!1,document.removeEventListener("click",this.handleOutsideClick)}handleMenuSelection(t){switch(this.closeMenu(),t){case"nps":this.openNPS();break;case"suggestion":this.openSuggestion();break;case"bug":this.openBug()}}getMenuStyles(){return`\n      position: fixed;\n      ${this.getMenuPositionStyles()}\n      background: white;\n      border-radius: 12px;\n      box-shadow: 0 10px 40px rgba(0,0,0,0.2);\n      z-index: 2147483647;\n      min-width: 200px;\n      ${this.isReducedMotion?"":"animation: tf-menu-appear 0.2s ease-out;"}\n      transition: opacity 0.2s, transform 0.2s;\n      transform-origin: bottom right;\n    `}getMenuPositionStyles(){const t={"bottom-right":"bottom: 80px; right: 20px;","bottom-left":"bottom: 80px; left: 20px;","top-right":"top: 80px; right: 20px;","top-left":"top: 80px; left: 20px;"};return t[this.config.position]||t["bottom-right"]}getMenuItemStyles(){return`\n      display: flex;\n      align-items: center;\n      width: 100%;\n      padding: 12px 16px;\n      background: none;\n      border: none;\n      border-radius: 8px;\n      cursor: pointer;\n      font-family: inherit;\n      font-size: 14px;\n      color: #374151;\n      transition: background ${this.isReducedMotion?"0s":"0.15s"};\n      text-align: left;\n      outline-offset: 2px;\n    `}updateAnimationStyles(){this.floatingButton&&(this.floatingButton.style.cssText=this.getButtonStyles())}openNPS(){this.npsModal&&this.npsModal.close(),this.npsModal=new e({projectId:this.config.projectId,apiKey:this.config.apiKey,apiUrl:this.config.apiUrl,reducedMotion:this.isReducedMotion,onClose:()=>{this.npsModal=null,this.floatingButton?.focus()}}),this.npsModal.open()}openSuggestion(){this.suggestionModal&&this.suggestionModal.close(),this.suggestionModal=new o({projectId:this.config.projectId,apiKey:this.config.apiKey,apiUrl:this.config.apiUrl,reducedMotion:this.isReducedMotion,onClose:()=>{this.suggestionModal=null,this.floatingButton?.focus()}}),this.suggestionModal.open()}openBug(){this.bugModal&&this.bugModal.close(),this.bugModal=new r({projectId:this.config.projectId,apiKey:this.config.apiKey,apiUrl:this.config.apiUrl,reducedMotion:this.isReducedMotion,onClose:()=>{this.bugModal=null,this.floatingButton?.focus()}}),this.bugModal.open()}close(){this.npsModal?.close(),this.npsModal=null,this.suggestionModal?.close(),this.suggestionModal=null,this.bugModal?.close(),this.bugModal=null,this.closeMenu()}inferApiUrl(){const t=document.querySelectorAll("script");for(let e=0;e<t.length;e++){const n=t[e].src;if(n.includes("tinyfeedback")){const t=new URL(n);return`${t.protocol}//${t.host}`}}return""}}if("undefined"!=typeof window){window.TinyFeedback=a,window.TinyFeedbackWidget=a;const t=window.__TF_CONFIG__;if(t?.projectId&&t?.apiKey){const e=new a(t);e.init(),window.__TF_WIDGET__=e,window.__TF_OPEN_NPS__&&e.openNPS(),window.__TF_OPEN_SUGGESTION__&&e.openSuggestion()}}const l=document.createElement("style");return l.textContent=`\n  @keyframes tf-menu-appear {\n    from { opacity: 0; transform: scale(0.95) translateY(-10px); }\n    to { opacity: 1; transform: scale(1) translateY(0); }\n  }\n  \n  .tf-menu-item:hover { \n    background: #f3f4f6 !important; \n  }\n  \n  .tf-menu-item:focus-visible {\n    background: #f3f4f6 !important;\n    outline: 2px solid ${document.querySelector("#tinyfeedback-button")?.getAttribute("style")?.includes("background:")&&document.querySelector("#tinyfeedback-button")?.getAttribute("style")?.match(/background:\s*([^;]+)/)?.[1]||"#3b82f6"};\n    outline-offset: -2px;\n  }\n  \n  /* Visually hidden class for screen reader text */\n  .visually-hidden {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n  }\n  \n  /* High contrast mode support */\n  @media (prefers-contrast: high) {\n    .tf-menu-item {\n      border: 2px solid currentColor !important;\n    }\n  }\n  \n  /* Reduced motion support */\n  @media (prefers-reduced-motion: reduce) {\n    *, *::before, *::after {\n      animation-duration: 0.01ms !important;\n      animation-iteration-count: 1 !important;\n      transition-duration: 0.01ms !important;\n    }\n  }\n  \n  /* Focus visible styles */\n  #tinyfeedback-button:focus-visible {\n    outline: 3px solid #fff;\n    outline-offset: 3px;\n    box-shadow: 0 0 0 6px rgba(59, 130, 246, 0.5);\n  }\n`,document.head?.appendChild(l),t.BugModal=r,t.NPSModal=e,t.SuggestionModal=o,t.TinyFeedbackWidget=a,t}({});
