var TinyFeedback=function(t){"use strict";class e{constructor(t){this.container=null,this.selectedScore=null,this.options=t}open(){this.createModal(),this.attachEventListeners()}close(){this.container&&(this.container.remove(),this.container=null),this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-nps-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-nps-content",t.style.cssText=this.getModalStyles();const e=document.createElement("div");e.style.cssText=this.getHeaderStyles(),e.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">How likely are you to recommend us?</h3>\n      <p style="${this.getSubtitleStyles()}">Rate from 0 (not likely) to 10 (very likely)</p>\n    `;const n=document.createElement("div");n.id="tf-nps-scale",n.style.cssText=this.getScaleContainerStyles();for(let t=0;t<=10;t++){const e=this.createRatingButton(t);n.appendChild(e)}const s=document.createElement("div");s.id="tf-nps-comment-section",s.style.cssText=this.getCommentSectionStyles(),s.style.display="none",s.innerHTML=`\n      <textarea \n        id="tf-nps-comment" \n        placeholder="Tell us more about your experience (optional)"\n        style="${this.getTextareaStyles()}"\n      ></textarea>\n    `;const i=document.createElement("button");i.id="tf-nps-submit",i.textContent="Send Feedback",i.style.cssText=this.getSubmitButtonStyles(),i.style.display="none";const o=document.createElement("button");o.id="tf-nps-close",o.textContent="Ã—",o.style.cssText=this.getCloseButtonStyles(),t.appendChild(o),t.appendChild(e),t.appendChild(n),t.appendChild(s),t.appendChild(i),this.container.appendChild(t),document.body.appendChild(this.container)}createRatingButton(t){const e=document.createElement("button");return e.className="tf-nps-rating-btn",e.dataset.score=t.toString(),e.textContent=t.toString(),e.style.cssText=this.getRatingButtonStyles(t),e}attachEventListeners(){if(!this.container)return;this.container.querySelectorAll(".tf-nps-rating-btn").forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.dataset.score||"0");this.selectScore(e)})});const t=this.container.querySelector("#tf-nps-submit");t?.addEventListener("click",()=>this.submit());const e=this.container.querySelector("#tf-nps-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()})}selectScore(t){this.selectedScore=t;const e=this.container?.querySelectorAll(".tf-nps-rating-btn");e?.forEach(e=>{const n=parseInt(e.dataset.score||"0");e.style.cssText=n===t?this.getSelectedRatingButtonStyles(t):this.getRatingButtonStyles(n)});const n=this.container?.querySelector("#tf-nps-comment-section"),s=this.container?.querySelector("#tf-nps-submit");n&&(n.style.display="block"),s&&(s.style.display="block")}async submit(){if(null===this.selectedScore)return;const t=this.container?.querySelector("#tf-nps-comment"),e=t?.value?.trim();try{(await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"nps",nps_score:this.selectedScore,content:e||"",page_url:window.location.href,user_agent:navigator.userAgent})})).ok?(this.showThankYou(),this.options.onSubmit?.(this.selectedScore,e)):(console.error("Failed to submit NPS feedback"),alert("Failed to submit feedback. Please try again."))}catch(t){console.error("Error submitting NPS:",t),alert("Failed to submit feedback. Please try again.")}}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-nps-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">ðŸŽ‰</div>\n          <h3 style="${this.getTitleStyles()}">Thank you!</h3>\n          <p style="${this.getSubtitleStyles()}">Your feedback helps us improve.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      position: relative;\n      box-shadow: 0 0 40px rgba(0, 255, 136, 0.1);\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getScaleContainerStyles(){return"\n      display: flex;\n      justify-content: center;\n      gap: 6px;\n      margin-bottom: 20px;\n      flex-wrap: wrap;\n    "}getRatingButtonStyles(t){const e=this.getScoreColor(t);return`\n      width: 36px;\n      height: 36px;\n      border: 1px solid ${e};\n      background: transparent;\n      color: ${e};\n      font-size: 14px;\n      font-weight: 500;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `}getSelectedRatingButtonStyles(t){const e=this.getScoreColor(t);return`\n      width: 36px;\n      height: 36px;\n      border: 1px solid ${e};\n      background: ${e};\n      color: #000;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 0 10px ${e}80;\n    `}getScoreColor(t){return t<=6?"#ff4444":t<=8?"#ffaa00":"#00ff88"}getCommentSectionStyles(){return"\n      margin-bottom: 20px;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 80px;\n      padding: 12px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      background: #00ff88;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}}class n{constructor(t){this.container=null,this.titleInput=null,this.descriptionTextarea=null,this.options=t}open(){this.createModal(),this.attachEventListeners(),setTimeout(()=>this.titleInput?.focus(),100)}close(){this.container&&(this.container.remove(),this.container=null),this.options.onClose?.()}createModal(){this.container=document.createElement("div"),this.container.id="tf-suggestion-modal",this.container.style.cssText=this.getContainerStyles();const t=document.createElement("div");t.id="tf-suggestion-content",t.style.cssText=this.getModalStyles();const e=document.createElement("button");e.id="tf-suggestion-close",e.textContent="Ã—",e.style.cssText=this.getCloseButtonStyles();const n=document.createElement("div");n.style.cssText=this.getHeaderStyles(),n.innerHTML=`\n      <h3 style="${this.getTitleStyles()}">ðŸ’¡ SugestÃ£o de Feature</h3>\n      <p style="${this.getSubtitleStyles()}">Tem uma ideia para melhorar nosso produto? Conta pra gente!</p>\n    `;const s=document.createElement("form");s.id="tf-suggestion-form",s.style.cssText=this.getFormStyles();const i=document.createElement("div");i.style.cssText=this.getFieldGroupStyles();const o=document.createElement("label");o.htmlFor="tf-suggestion-title",o.style.cssText=this.getLabelStyles(),o.innerHTML='TÃ­tulo da sugestÃ£o <span style="color: #ff4444;">*</span>',this.titleInput=document.createElement("input"),this.titleInput.id="tf-suggestion-title",this.titleInput.type="text",this.titleInput.placeholder="Ex: Adicionar modo escuro",this.titleInput.required=!0,this.titleInput.style.cssText=this.getInputStyles(),i.appendChild(o),i.appendChild(this.titleInput);const r=document.createElement("div");r.style.cssText=this.getFieldGroupStyles();const l=document.createElement("label");l.htmlFor="tf-suggestion-description",l.style.cssText=this.getLabelStyles(),l.textContent="DescriÃ§Ã£o (opcional)",this.descriptionTextarea=document.createElement("textarea"),this.descriptionTextarea.id="tf-suggestion-description",this.descriptionTextarea.placeholder="Descreva sua sugestÃ£o em detalhes...",this.descriptionTextarea.style.cssText=this.getTextareaStyles(),r.appendChild(l),r.appendChild(this.descriptionTextarea);const a=document.createElement("button");a.id="tf-suggestion-submit",a.type="submit",a.textContent="Enviar SugestÃ£o",a.style.cssText=this.getSubmitButtonStyles(),s.appendChild(i),s.appendChild(r),s.appendChild(a),t.appendChild(e),t.appendChild(n),t.appendChild(s),this.container.appendChild(t),document.body.appendChild(this.container)}attachEventListeners(){if(!this.container)return;const t=this.container.querySelector("#tf-suggestion-form");t?.addEventListener("submit",t=>{t.preventDefault(),this.submit()});const e=this.container.querySelector("#tf-suggestion-close");e?.addEventListener("click",()=>this.close()),this.container.addEventListener("click",t=>{t.target===this.container&&this.close()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&this.container&&this.close()})}async submit(){if(!this.titleInput)return;const t=this.titleInput.value.trim(),e=this.descriptionTextarea?.value?.trim()||"";if(!t)return this.showError("O tÃ­tulo Ã© obrigatÃ³rio"),void this.titleInput?.focus();try{(await fetch(`${this.options.apiUrl}/api/widget/feedback`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":this.options.apiKey},body:JSON.stringify({project_id:this.options.projectId,type:"suggestion",title:t,content:e,page_url:window.location.href,user_agent:navigator.userAgent})})).ok?(this.showThankYou(),this.options.onSubmit?.(t,e)):(console.error("Failed to submit suggestion"),this.showError("Falha ao enviar sugestÃ£o. Tente novamente."))}catch(t){console.error("Error submitting suggestion:",t),this.showError("Falha ao enviar sugestÃ£o. Tente novamente.")}}showError(t){const e=this.container?.querySelector("#tf-suggestion-error");e?.remove();const n=document.createElement("div");n.id="tf-suggestion-error",n.style.cssText=this.getErrorStyles(),n.textContent=t;const s=this.container?.querySelector("#tf-suggestion-form");s?.insertBefore(n,s.firstChild)}showThankYou(){if(!this.container)return;const t=this.container.querySelector("#tf-suggestion-content");t&&(t.innerHTML=`\n        <div style="${this.getThankYouStyles()}">\n          <div style="font-size: 48px; margin-bottom: 16px;">ðŸŽ‰</div>\n          <h3 style="${this.getTitleStyles()}">Obrigado!</h3>\n          <p style="${this.getSubtitleStyles()}">Sua sugestÃ£o foi enviada com sucesso.</p>\n        </div>\n      `),setTimeout(()=>this.close(),2e3)}getContainerStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 999999;\n      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    "}getModalStyles(){return"\n      background: #000;\n      border: 1px solid #333;\n      padding: 32px;\n      max-width: 500px;\n      width: 90%;\n      position: relative;\n      box-shadow: 0 0 40px rgba(0, 255, 136, 0.1);\n    "}getCloseButtonStyles(){return"\n      position: absolute;\n      top: 12px;\n      right: 12px;\n      width: 32px;\n      height: 32px;\n      background: transparent;\n      border: none;\n      color: #888;\n      font-size: 24px;\n      line-height: 1;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: color 0.2s ease;\n    "}getHeaderStyles(){return"\n      text-align: center;\n      margin-bottom: 24px;\n    "}getTitleStyles(){return"\n      margin: 0 0 8px 0;\n      font-size: 20px;\n      font-weight: 600;\n      color: #fff;\n    "}getSubtitleStyles(){return"\n      margin: 0;\n      font-size: 14px;\n      color: #888;\n    "}getFormStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 16px;\n    "}getFieldGroupStyles(){return"\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n    "}getLabelStyles(){return"\n      font-size: 14px;\n      font-weight: 500;\n      color: #fff;\n    "}getInputStyles(){return"\n      width: 100%;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      box-sizing: border-box;\n      font-family: inherit;\n      transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    "}getTextareaStyles(){return"\n      width: 100%;\n      min-height: 120px;\n      padding: 12px 16px;\n      border: 1px solid #333;\n      background: #111;\n      color: #fff;\n      font-size: 14px;\n      resize: vertical;\n      box-sizing: border-box;\n      font-family: inherit;\n      transition: border-color 0.2s ease, box-shadow 0.2s ease;\n    "}getSubmitButtonStyles(){return"\n      width: 100%;\n      padding: 14px;\n      margin-top: 8px;\n      background: #00ff88;\n      color: #000;\n      border: none;\n      font-size: 16px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s ease;\n    "}getErrorStyles(){return"\n      padding: 12px 16px;\n      background: rgba(255, 68, 68, 0.1);\n      border: 1px solid #ff4444;\n      color: #ff4444;\n      font-size: 14px;\n      margin-bottom: 16px;\n    "}getThankYouStyles(){return"\n      text-align: center;\n      padding: 40px 20px;\n    "}}class s{constructor(t){this.npsModal=null,this.suggestionModal=null,this.config={apiUrl:"",...t},this.config.apiUrl||(this.config.apiUrl=this.inferApiUrl())}openNPS(){this.npsModal&&this.npsModal.close(),this.npsModal=new e({projectId:this.config.projectId,apiKey:this.config.apiKey,apiUrl:this.config.apiUrl,onClose:()=>{this.npsModal=null}}),this.npsModal.open()}openSuggestion(){this.suggestionModal&&this.suggestionModal.close(),this.suggestionModal=new n({projectId:this.config.projectId,apiKey:this.config.apiKey,apiUrl:this.config.apiUrl,onClose:()=>{this.suggestionModal=null}}),this.suggestionModal.open()}close(){this.npsModal?.close(),this.npsModal=null,this.suggestionModal?.close(),this.suggestionModal=null}inferApiUrl(){const t=document.querySelectorAll("script");for(let e=0;e<t.length;e++){const n=t[e].src;if(n.includes("tinyfeedback")){const t=new URL(n);return`${t.protocol}//${t.host}`}}return""}}if("undefined"!=typeof window){window.TinyFeedback=s;const t=window.__TF_CONFIG__;if(t?.projectId&&t?.apiKey){const e=new s(t);window.__TF_OPEN_NPS__&&e.openNPS(),window.__TF_OPEN_SUGGESTION__&&e.openSuggestion()}}return t.NPSModal=e,t.SuggestionModal=n,t.TinyFeedbackWidget=s,t}({});
